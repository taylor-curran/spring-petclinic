---
applications:
- name: account-service
  instances: 3
  memory: 1024M
  disk_quota: 2G
  stack: cflinuxfs4
  buildpacks:
    - java_buildpack
  path: ./target/account-service-1.2.0.jar
  
  env:
    SPRING_PROFILES_ACTIVE: production
    JBP_CONFIG_OPEN_JDK_JRE: '[jre: {version: 17.+}]'
    SERVER_PORT: 8080
    MANAGEMENT_SERVER_PORT: 8081
    
    # Database Configuration
    DB_POOL_SIZE: 20
    DB_CONNECTION_TIMEOUT: 30000
    DB_IDLE_TIMEOUT: 600000
    
    # Service Discovery
    EUREKA_CLIENT_ENABLED: true
    EUREKA_INSTANCE_HOSTNAME: account-service
    
    # Monitoring
    NEWRELIC_ENABLED: true
    DATADOG_TRACE_ENABLED: true
    
  services:
    - account-postgres-db
    - account-redis-cache
    - config-server
    - service-registry
    - circuit-breaker-dashboard
    
  routes:
    - route: account-api.apps.banking.com
    - route: account-internal.apps.banking.com
      
  health-check-type: http
  health-check-http-endpoint: /actuator/health
  health-check-invocation-timeout: 10
  
  command: java -jar account-service-1.2.0.jar --server.port=$PORT
